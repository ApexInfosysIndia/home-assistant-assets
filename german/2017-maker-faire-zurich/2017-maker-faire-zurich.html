<!DOCTYPE html>
<html lang=en>
<head>
    <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
    <meta name=viewport content="width=device-width,initial-scale=1">
    <meta name="description" content="Home Assistant - Setup" />
    <meta name="author" content="Fabian Affolter" />
    <link rel="stylesheet" href="remark-ha.css" type="text/css" media="screen" charset="utf-8">
    <title>Home Assistant - Maker Faire Zurück 2017</title>
</head>

<body onload="
var slideshow = remark.create(
{ratio: '16:9',
navigation: {scroll: true, touch: true, click: false},
countIncrementalSlides: false
}
);

/*
// every 8 seconds (change to your desired interval), fire the helper function
setInterval(function () {carousel(slideshow)}, 8000);

function carousel(varObject) {
    var slideCount = varObject.getSlideCount()-1;
    var currentSlide = varObject.getCurrentSlideIndex();
    // if the slideshow is on the last slide, go back to the first slide; if not, call gotoNextSlide();
    if (currentSlide == slideCount) {
        varObject.gotoFirstSlide();
    }
    else { varObject.gotoNextSlide(); }
};*/
">

<textarea id="source">

class: center, middle

![Home Assistant](images/ha-logo.png)

# Home Assistant
### Awaken your home

Maker Faire Zurück 2017

---

.header[![](images/ha-header.svg)]

# Agenda

1. Einführung
2. Installation
3. Konfiguration

---

# Über mich

- B. Sc. CS BUAS, B. Sc. ME BUAS
- [affolter engineering](http://affolter-engineering.ch/)
- Home Assistant Core Developer
- Fedora Security Lab / Fedora Security Lab Test bench
- Package Maintainer (ca. 190 packages)
- Alpine Linux Contributor

---

.header[![](images/ha-header.svg)]

# Später für Fragen und ähnliches

- **IRC**: faffolter
- **Mail**: mail@fabian-affolter.ch
- **Jabber**: fab@swissjabber.org
- **Web**: [http://fabian-affolter.ch](http://fabian-affolter.ch)

---

.header[![](images/ha-header.svg)]

# Internet of things

.left-column[
- Lampen
- Schalter
- Thermostat
- Wasserkocher
- Zahnbürste
- Kameras
- Staubsauger
]

.right-column[
- Waschmaschine
- Bewässerung
- Schlösser
- Temperatur
- Türen
- Tierfütterung
- ...
]

---

.header[![](images/ha-header.svg)]

# Internet of things - Problematik

- Abhängigkeit von Hersteller
- Insel-Lösungen
- Cloud
- Mobile App
- Preis
- etc.

---

.header[![](images/ha-header.svg)]

# Protokolle & Busse

- SOHO-Einsatz
  - Bluetooth, Bluetooth LE, IEEE 802.x, Z-Wave, X10, KNX, ZigBee, IR, LoRA, SCS, Universal Powerline Bus, Insteon, EnOcean, C-BUS, etc.

--
- Industrieller Einsatz
  - CAN, Profibus, Modbus, Interbus, EtherCAT, ControlNet, SafetyBUS, BitBus, etc.

---

.header[![](images/ha-header.svg)]

# Wieso?




---

.header[![](images/ha-header.svg)]

# Home Assistant

- Python 3
- über 750 Integrationen
- Apache 2.0 (früher MIT)
- fast 4 Jahre alt (Erster Commit: 17. September 2013)
- Validierung mit PEP8 / PyFlakes / PyLint
- 94 % Test coverage (ohne Integrationen)
- Automatische Abhängigkeitsverwaltung

---

background-image: url(images/components.png)

---

.header[![](images/ha-header.svg)]

# Verfügbare Implementierungen

- MQTT, Insteon, Modbus, RFXtrx, Z-Wave, ZigBee, SCSGate, KNX, etc.

--
- Arduino, Raspberry PI GPIO, Cubieboard, Beaglebone Black

--
- Webservices

.footnote[Component overview: https://home-assistant.io/components/#all]

---

.header[![](images/ha-header.svg)]

## Wo?

<img src="images/location.png" alt="Home Assistant Location" style="width:700px;">

---

.header[![](images/ha-header.svg)]

# Betriebssysteme

- Linux
- Windows
- macOS
- *BSD

---

.header[![](images/ha-header.svg)]

# Vorbereitungen

- Virtual environment !
- Kompiler, Bibliotheken
- Python
- etc.

---

# Optionen

<img src="images/installation.png" alt="Home Assistant Installation" style="width:400px;">

.footnote[Installation overview: https://home-assistant.io/docs/installation/]

---

.header[![](images/ha-header.svg)]

# Installation

```bash
$ sudo pip3 install homeassistant
```
--

## Alternativen

- [Hass.io](https://home-assistant.io/hass.io/) (Image)
- [HASSbian](https://home-assistant.io/getting-started/installation-raspberry-pi-image/) (Image)
- [Raspberry Pi All-In-One Installer](https://home-assistant.io/getting-started/installation-raspberry-pi-all-in-one/)
- [Ansible Role](https://github.com/home-assistant/home-assistant-ansible)

---

.header[![](images/ha-header.svg)]

# Erzeugen von `configuration.yaml`

- erster Start von Home Assistant
- manuell
- Script

```bash
$ hass --script ensure_config
```

.footnote[Scripts: https://home-assistant.io/docs/tools/scripts/#existance-of-configuration]

---

.header[![](images/ha-header.svg)]

# Initiale Konfiguration

```yaml
homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: 50.8333
  longitude: 12.9167
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 300
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Berlin

# Show links to resources in log and frontend
introduction:

# Enables the frontend
frontend:
```

---

.header[![](images/ha-header.svg)]

# Format `configuration.yaml`

- YAML
- Einrückungen
- `key-value`-Paare (Format `key: value`)
- Jede Collection startet mit einem `-`
- Wenn doppelte Einträge, dann wird letzter genutzt
- Linter

.footnote[YAML: https://home-assistant.io/docs/configuration/yaml/]

---

.header[![](images/ha-header.svg)]

# Start

```bash
$ hass
$ hass --config path/to/config
```

--
### Demo mode

```bash
$ hass --demo-mode
```
--
### Frontend öffnen

```bash
$ hass --open-ui
```
---

.header[![](images/ha-header.svg)]

# Speicherort

| Betriebssystem | Pfad |
|:-------------- | ----:|
| macOS | `~/.homeassistant` |
| Linux | `~/.homeassistant` |
| Windows | `%APPDATA%/.homeassistant` |

.footnote[Configuring Home Assistant: https://home-assistant.io/getting-started/configuration/]

---

.header[![](images/ha-header.svg)]

# Measuring Box

- ESP32, Sensor, Breadboard, Kabel und Gehäuse
- Basic, Outdoor, Deluxe
- Webserver-, ThingSpeak-, RESTful API-, und MQTT-Unterstützung
- Programmierbar durch Arduino IDE oder Micropython

---

.header[![](images/ha-header.svg)]

# Measuring Box

<img src="images/me-box.png" alt="Measuring Box Basic Edition" style="width:400px;">

---

.header[![](images/ha-header.svg)]

# Measuring Box - RESTful API

- Endpunkte
  - Alle Werte: `/api/states`
  - Gerät-Status: `/api/device`
  - Temperatur: `/api/temperature`
  - Luftfeuchtigkeit: `/api/humidity`
  - Luftdruck: `/api/pressure`
  - Hall: `/api/hall`
  - LED: `/api/led`

---

.header[![](images/ha-header.svg)]

# Measuring Box - RESTful API

```bash
$ curl http://192.168.0.209/api/states
{

}
```

---

.header[![](images/ha-header.svg)]

# `command_line`-Sensor

```yaml
sensor:
  - platform: command_line
    name: MEBox Temperature
    command: curl http://192.168.0.209/api/temperature
    value_template: {{ value_json.state }}
```

--

# `rest`-Sensor

```yaml
sensor:
  - platform: rest
    name: MEBox Humidity
    resource: http://192.168.0.209:5000/api/humidity
    value_template: {{ value_json.state }}
```

.footnote[Details: https://home-assistant.io/components/sensor.command_line/ & https://home-assistant.io/components/sensor.rest/]

---

.header[![](images/ha-header.svg)]

# Pull vs. Push

- Abholen
- Liefern lassen

--
- REST API -> poll
- MQTT -> push

---

.header[![](images/ha-header.svg)]

# MQTT

- braucht einen Broker
  - Mosquitto
  - Home Assistant (HBMQTT)
- mehr Konfiguration

.left-column[
```yaml
# Embedded MQTT broker
mqtt:
```
]

.right-column[
```yaml
# Other MQTT broker
mqtt:
  broker: 127.0.0.1
```
]

.footnote[Details: https://home-assistant.io/docs/mqtt/broker/]

---

.header[![](images/ha-header.svg)]

# MQTT Sensoren hinzufügen

- Ein Topic pro Sensor
- Für Umrechnungen `template`-Sensor 

```yaml
sensor:
  - platform: mqtt
    state_topic: "home/temperatur"
    name: "MQTT Temperatur"
  - platform: mqtt
    state_topic: "home/humidity"
    name: "MQTT Luftfeuchtigkeit"
```

---

.header[![](images/ha-header.svg)]

# MQTT Switch hinzufügen

- Ein Topic für Befehl
- Ein Topic für Status 

```yaml
sensor:
  - platform: mqtt
    command_topic: "home/led/set"
    state_topic: "home/led"
    name: "MQTT LED"
```

---

class: middle
.header[![](images/ha-header.svg)]

- **Dokumentation**: <br/>
  [https://home-assistant.io/](https://home-assistant.io/)
- **Community**: <br/>
  [https://community.home-assistant.io/](https://community.home-assistant.io/)
- **Chat**: <br/>
  [https://gitter.im/home-assistant/home-assistant](https://gitter.im/home-assistant/home-assistant)

---

class: center, middle

<img src="images/ha-logo.png" alt="Home Assistant Logo" style="width:400px;">

# [https://home-assistant.io](https://home-assistant.io.org)

---

.header[![](images/ha-header.svg)]

# Teil 2

- Weitere relevante Informationen für die Konfiguration von Home Assistant.

---

.header[![](images/ha-header.svg)]

# Andere "Dinge" hinzufügen

.left-column[
```yaml
sensor:
  - platform: mqtt
    state_topic: "home/2/temp"
    name: "MQTT Sensor 1"
  - platform: mqtt
    state_topic: "home/1/temp"
    name: "MQTT Sensor 2"
  - platform: moon
switch:
  - platform: vera
  - platform: mystrom
    host: 10.100.0.104
    name: MyStrom Switch
```
]

.right-column[
```yaml
sensor 1:
  platform: mqtt
  state_topic: "home/1/temp"
  name: "MQTT Sensor 1"
sensor 2:
  platform: mqtt
  state_topic: "home/2/temp"
  name: "MQTT Sensor 2"
camera 1:
  platform: generic
camera 2:
  platform: mjpeg
```
]

---

.header[![](images/ha-header.svg)]

# Aufteilen der Konfiguration

- Auslagerung von Teilen
- Kombinationen möglich

```yaml
sensor: !include sensors.yaml
```

in `sensors.yaml`

```yaml
- platform: vera
- platform: mystrom
  host: 10.100.0.104
  name: MyStrom Switch
```

.footnote[Splitting configuration: https://home-assistant.io/docs/configuration/splitting_configuration/]

---

.header[![](images/ha-header.svg)]

# Organisation `packages`

In `configuration.yaml`

```yaml
homeassistant:
  [...]
  packages: 
    pack_1: !include workshop.yaml
```

in `workshop.yaml`

```yaml
switch:
  - platform: rest
  - platform: mystrom
sensor:
  - platform: random
```

---

.header[![](images/ha-header.svg)]

# Auslagern von Secrets

- keine API keys, Token und Passwörter
- zentraler Speicherort
- Unterstützung für Keyring

.footnote[Storing secrets: https://home-assistant.io/docs/configuration/secrets/]

---

.header[![](images/ha-header.svg)]

# Auslagern von Secrets (2)

`secrets.yaml` im Konfigurationsverzeichnis

```yaml
do_api: 2adf28f0e90f13f309d12376cd
```

in `configuration.yaml`

```yaml
digital_ocean:
  access_token: !secret do_api
```

---

.header[![](images/ha-header.svg)]

# Remote access

- IoT ist unsicher
- Zugang von aussen
- Tor/VPN

---

.header[![](images/ha-header.svg)]

# Gruppieren

- Zusammenfassung von Elementen
- `default_view:` für `HOME`
- `view: yes` für Tab

```yaml
group:
  default_view:
    view: yes
    entities:
      - group.kitchen
      - group.awesome_people
      - group.climate
  random:
    name: Random
    entities:
      - sensor.random1
      - sensor.random2
```

---

.header[![](images/ha-header.svg)]

# Anpassen

```yaml
customize:
  # Only the 'entity_id' is required.  All other options are optional.
  - entity_id: sensor.living_room_motion
    hidden: true
```

---

.header[![](images/ha-header.svg)]

# Datenbank

- Standard ist SQLite
- SQLAlchemy als Object Relational Mapper (ORM)
- Unterstützung für MySQL, mariaDB und Postgresql

```yaml
recorder:
```
- `purge_days: 5`

---

.header[![](images/ha-header.svg)]

# Web server

- inklusive (`aiohttp`)
- liefert Frontend

```yaml
http:
  api_password: YOUR_PASSWORD
```

.footnote[HTTP component: https://home-assistant.io/components/http/]

---

.header[![](images/ha-header.svg)]

# Web server (2)

- Support für SSL/TLS

```yaml
http:
  ssl_certificate: /etc/letsencrypt/test/hass.example.com/fullchain.pem
  ssl_key: /etc/letsencrypt/test/hass.example.com/privkey.pem
```

- `server_host`, `server_port`
- `trusted_networks`
- `ip_ban_enabled`, `login_attempts_threshold`

---

.header[![](images/ha-header.svg)]

# Testen der Konfiguration

```bash
$ hass --script check_config
```

---

.header[![](images/ha-header.svg)]

# Autostart

- systemd
- upstart
- macOS

---

.header[![](images/ha-header.svg)]

# Schnittstellen

- Websocket API
- RESTful API
- Python API
- Server-sent events

---

class: middle
.header[![](images/ha-header.svg)]

- **Dokumentation**: <br/>
  [https://home-assistant.io/](https://home-assistant.io/)
- **Community**: <br/>
  [https://community.home-assistant.io/](https://community.home-assistant.io/)
- **Chat**: <br/>
  [https://gitter.im/home-assistant/home-assistant](https://gitter.im/home-assistant/home-assistant)

---

class: center, middle

<img src="images/ha-logo.png" alt="Home Assistant Logo" style="width:400px;">

# [https://home-assistant.io](https://home-assistant.io.org)

</textarea>
    <script type="text/javascript" src="remark-latest.min.js"></script>
</body>
</html>
